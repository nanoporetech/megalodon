

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>megalodon_extras modified_bases &mdash; Megalodon 2.3.3 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="megalodon_extras phase_variants" href="extras_phase_variants.html" />
    <link rel="prev" title="megalodon_extras merge" href="extras_merge.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Megalodon
          

          
          </a>

          
            
            
              <div class="version">
                2.3.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="algorithm_details.html">Megalodon Algorithm Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="common_arguments.html">Common Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_arguments.html">Advanced Megalodon Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="computing_considerations.html">Computing Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="variant_phasing.html">Variant Phasing</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_formats.html">File Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_training.html">Megalodon Model Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="modbase_training.html">Megalodon Modified Base Model Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="extras_aggregate.html"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">aggregate</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="extras_calibrate.html"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">calibrate</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="extras_merge.html"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">merge</span></code></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#megalodon-extras-modified-bases-describe-alphabet"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">describe_alphabet</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#megalodon-extras-modified-bases-estimate-threshold"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">estimate_threshold</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#deprecated-megalodon-extras-modified-bases-update-database">[DEPRECATED] <code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">update_database</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#megalodon-extras-modified-bases-create-ground-truth"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">create_ground_truth</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#megalodon-extras-modified-bases-create-motif-bed"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">create_motif_bed</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#megalodon-extras-modified-bases-per-site-thresholds"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">per_site_thresholds</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#megalodon-extras-modified-bases-index-database"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">index_database</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#megalodon-extras-modified-bases-split-by-motif"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">split_by_motif</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extras_phase_variants.html"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">phase_variants</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="extras_per_read_text.html"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">per_read_text</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="extras_validate.html"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">validate</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="extras_variants.html"><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">variants</span></code></a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Megalodon</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/extras_modified_bases.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="megalodon-extras-modified-bases">
<h1><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span></code><a class="headerlink" href="#megalodon-extras-modified-bases" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span></code> command group contains various commands related to modified base processing within Megalodon.</p>
<div class="section" id="megalodon-extras-modified-bases-describe-alphabet">
<h2><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">describe_alphabet</span></code><a class="headerlink" href="#megalodon-extras-modified-bases-describe-alphabet" title="Permalink to this headline">¶</a></h2>
<p>Describe the alphabet, including modified bases, found in a given model.</p>
<p>This command is useful to determine the syntax for specifying arguments related to modified base detection.</p>
<p>Note that originally modified bases were specified by arbitrary values, but recent and future models will attempt to follow single letter codes specified by <a class="reference external" href="https://github.com/samtools/hts-specs/pull/418">samtools hts-spec (currently an open issue)</a>.</p>
<p>A minimal subset of the model specifications from the main <code class="docutils literal notranslate"><span class="pre">megalodon</span></code> command are available to specify the model exactly as in the main command.
The model will be loaded as normal and the alphabet used will be printed.</p>
</div>
<div class="section" id="megalodon-extras-modified-bases-estimate-threshold">
<h2><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">estimate_threshold</span></code><a class="headerlink" href="#megalodon-extras-modified-bases-estimate-threshold" title="Permalink to this headline">¶</a></h2>
<p>Estimate the optimal global modified base score threshold such that the estimated proportion of bases modified is achieved when all sites are called.
This command is useful when producing the <code class="docutils literal notranslate"><span class="pre">signal_mappings</span></code> or <code class="docutils literal notranslate"><span class="pre">per_read_refs</span></code> outputs with modified bases annotated for basecaller training with Taiyaki.</p>
<p>This command works by estimating the proportion of bases modified from a sample using the most extreme calls (default most extreme 8%; set with <code class="docutils literal notranslate"><span class="pre">--mod-percentile</span></code> option) as a truth set.
This method assumes that the distribution of modified base and canonical scores is approximately balanced.
This may not be true for all models.
The plots produced by the <code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">calibrate</span> <span class="pre">modified_bases</span></code> command can assist in making this determination.</p>
</div>
<div class="section" id="deprecated-megalodon-extras-modified-bases-update-database">
<h2>[DEPRECATED] <code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">update_database</span></code><a class="headerlink" href="#deprecated-megalodon-extras-modified-bases-update-database" title="Permalink to this headline">¶</a></h2>
<p>This method has not been updated for the most recent modified base schema and thus is currently deprecated.</p>
</div>
<div class="section" id="megalodon-extras-modified-bases-create-ground-truth">
<h2><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">create_ground_truth</span></code><a class="headerlink" href="#megalodon-extras-modified-bases-create-ground-truth" title="Permalink to this headline">¶</a></h2>
<p>Create a set of ground truth sites from a bedmethyl file.
This is a convenience command to apply a threshold to observed fractions of modified bases from bedmethyl files produced by Megalodon or other software.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--strand-offset</span></code> is provided to allow calls on opposite strands to be combined.
For example forward and reverse strand CpG calls can be merged by setting <code class="docutils literal notranslate"><span class="pre">--strand-offset</span> <span class="pre">1</span></code> since the reverse strand position <code class="docutils literal notranslate"><span class="pre">1</span></code> downstream of the forward strand position correspond to the same biological methylation event.</p>
</div>
<div class="section" id="megalodon-extras-modified-bases-create-motif-bed">
<h2><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">create_motif_bed</span></code><a class="headerlink" href="#megalodon-extras-modified-bases-create-motif-bed" title="Permalink to this headline">¶</a></h2>
<p>This is a helper command to take a reference FASTA file and produce a BED file with all the locations of a motif of interest.
This can be useful for a number of modified base pipelines.</p>
</div>
<div class="section" id="megalodon-extras-modified-bases-per-site-thresholds">
<h2><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">per_site_thresholds</span></code><a class="headerlink" href="#megalodon-extras-modified-bases-per-site-thresholds" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference external" href="https://nanoporetech.github.io/megalodon/modbase_training.html#ground-truth-aided-bootstrap-modified-base-annotation">ground truth aided bootstrap modified base annotation</a> tutorial for more complete instructions on using this command.</p>
<p>This command is targeted at creating higher accuracy modified base training data sets (mapped signal files) from a preliminary modified base model and a fractionally (at each reference site) modified sample.
This command takes as input a Megalodon run with <code class="docutils literal notranslate"><span class="pre">--outputs</span> <span class="pre">per_read_mods</span> <span class="pre">mappings</span></code> and a ground truth bedmethyl file and produces a custom modified base threshold at each reference site.
These modified base thresholds will match the Megalodon modified base statistics with the ground truth faction of modified bases at each reference site.
The derived thresholds should then be supplied to Megalodon via the <code class="docutils literal notranslate"><span class="pre">--mod-per-site-threshold</span></code> argument along with the <code class="docutils literal notranslate"><span class="pre">--outputs</span> <span class="pre">signal_mappings</span></code>.</p>
<p>This command will also output a low coverage BED file containing reference sites covered by either too few ground truth or nanopore reads.
This should be used to filter reads for the final training mapped signal data set.
A read covering any low coverage sites will not be marked up as accurately and thus should not be included in model training.</p>
</div>
<div class="section" id="megalodon-extras-modified-bases-index-database">
<h2><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">index_database</span></code><a class="headerlink" href="#megalodon-extras-modified-bases-index-database" title="Permalink to this headline">¶</a></h2>
<p>In certain instances a megalodon run may end unexpectedly (e.g. out of memory error).
In most cases the modified bases database is not corrupted by such an unexpected run termination.
This will leave the modified base database without having completed the indexing step which is required for most downstream uses.
This command will produce the index as a separate step in such instances.</p>
</div>
<div class="section" id="megalodon-extras-modified-bases-split-by-motif">
<h2><code class="docutils literal notranslate"><span class="pre">megalodon_extras</span> <span class="pre">modified_bases</span> <span class="pre">split_by_motif</span></code><a class="headerlink" href="#megalodon-extras-modified-bases-split-by-motif" title="Permalink to this headline">¶</a></h2>
<p>Split an input modified base database into smaller databases based on reference sequence motifs.
This command enables the computationally expensive <code class="docutils literal notranslate"><span class="pre">megalodon</span></code> command to be run only once, while still allowing motif specific analyses.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="extras_phase_variants.html" class="btn btn-neutral float-right" title="megalodon_extras phase_variants" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="extras_merge.html" class="btn btn-neutral float-left" title="megalodon_extras merge" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, Oxford Nanopore Technologies.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>